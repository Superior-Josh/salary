<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>税后工资计算器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        h2 {
            font-size: 1.2em;
            color: #555;
            margin-top: 20px;
            margin-bottom: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        label {
            width: 180px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="number"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        .result-container {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        .columns {
            display: flex;
            gap: 30px;
        }
        
        .column {
            flex: 1;
        }
        
        /* 平板及以下尺寸的响应式样式 */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.4em;
                margin-bottom: 20px;
            }
            
            .input-group {
                margin-bottom: 12px;
                flex-direction: column;
                align-items: flex-start;
            }
            
            label {
                width: 100%;
                margin-bottom: 5px;
                font-size: 0.9em;
            }
            
            input[type="number"] {
                width: 100%;
                box-sizing: border-box;
            }
            
            .columns {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            
            .column {
                width: 100%;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px 5px;
            }
        }
        
        /* 手机端进一步优化 */
        @media screen and (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.2em;
            }
            
            .input-group {
                margin-bottom: 10px;
            }
            
            label {
                font-size: 0.85em;
            }
            
            input[type="number"] {
                font-size: 16px; /* 增大字体以便触摸 */
            }
            
            button {
                padding: 14px;
                font-size: 16px;
            }
            
            table {
                font-size: 0.85em;
            }
            
            th, td {
                padding: 6px 4px;
            }
        }
        
        /* 小屏幕手机端 */
        @media screen and (max-width: 360px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 8px;
            }
            
            h1 {
                font-size: 1.1em;
            }
            
            .input-group {
                margin-bottom: 8px;
            }
            
            label {
                font-size: 0.85em;
            }
            
            input[type="number"] {
                font-size: 16px;
            }
            
            table {
                font-size: 0.8em;
            }
            
            th, td {
                padding: 5px 3px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>税后工资计算器</h1>
        
        <div class="columns">
            <div class="column">
                <h2>输入信息</h2>
                <form id="salaryForm">
                    <div class="input-group">
                        <label for="monthlySalary">月薪:</label>
                        <input type="number" id="monthlySalary" value="20000" step="100" min="0">
                    </div>
                                        
                    <div class="input-group">
                        <label for="insuranceBase">社保公积金基数:</label>
                        <input type="number" id="insuranceBase" placeholder="默认与月薪相同">
                    </div>

                    <div class="input-group">
                        <label for="workDays">上班天数:</label>
                        <input type="number" id="workDays" placeholder="默认全勤">
                    </div>

                    <div class="input-group">
                        <label for="housingFundRate">公积金个人比例 (%):</label>
                        <input type="number" id="housingFundRate" value="8" step="0.1" min="0" max="100">
                    </div>
                                        
                    <div class="input-group">
                        <label for="otherDeductions">其他扣除项:</label>
                        <input type="number" id="otherDeductions" value="7" step="1" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label for="specialDeduction">个税专项附加扣除:</label>
                        <input type="number" id="specialDeduction" value="1500" step="100" min="0">
                    </div>

                    <div class="input-group">
                        <label for="mealAllowance">餐补:</label>
                        <input type="number" id="mealAllowance" value="450" step="50" min="0">
                    </div>
                    
                    <button type="submit">计算税后工资</button>
                </form>
            </div>
            
            <div class="column">
                <h2>计算结果</h2>
                <div id="resultContainer" class="result-container">
                    <table id="resultTable">
                        <thead>
                            <tr>
                                <th>项目</th>
                                <th>比例</th>
                                <th>金额</th>
                            </tr>
                        </thead>
                        <tbody id="resultDetails"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('salaryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateAfterTaxSalary();
        });

        // 税率区间定义
        const TAX_BRACKETS = [
            [3000, 3 / 100, 0], 
            [12000, 10 / 100, 210], 
            [25000, 20 / 100, 1410], 
            [35000, 25 / 100, 2660], 
            [55000, 30 / 100, 4410], 
            [80000, 35 / 100, 7160], 
            [Infinity, 45 / 100, 15160]
        ];

        // 社保费率定义
        const INSURANCE_RATES = { 
            pension: 8 / 100, 
            medical: 2 / 100, 
            unemployment: 0.3 / 100 
        };
        
        // 固定扣除额
        const DEDUCTION_STANDARD = 5000;

        function calculateAfterTaxSalary() {
            // 获取输入值
            const inputs = getInputs();
            
            // 计算应发工资
            const grossSalary = calculateGrossSalary(inputs.monthlySalary, inputs.workDays);
            
            // 计算折算后的餐补
            const mealAllowance = inputs.mealAllowance * (inputs.workDays ? inputs.workDays / 21.75 : 1);
            
            // 合并工资和餐补作为总收入
            const totalIncome = grossSalary + mealAllowance;

            // 计算社保公积金等扣除（注意：基数始终以月薪或用户指定的 `insuranceBase` 为准，与出勤天数无关；`其他扣除项`应在个税之后扣除）
            const insuranceBaseValue = inputs.insuranceBase || inputs.monthlySalary;
            const pensionAmount = insuranceBaseValue * INSURANCE_RATES.pension;
            const medicalAmount = insuranceBaseValue * INSURANCE_RATES.medical;
            const unemploymentAmount = insuranceBaseValue * INSURANCE_RATES.unemployment;
            const housingFundAmount = insuranceBaseValue * inputs.housingFundRate;
            const insuranceTotal = pensionAmount + medicalAmount + unemploymentAmount + housingFundAmount;

            // 计算应纳税所得额（不含其他扣除项）
            const taxableIncome = totalIncome - insuranceTotal - DEDUCTION_STANDARD - inputs.specialDeduction;

            // 计算个人所得税
            const personalIncomeTax = calculateTax(taxableIncome);

            // 计算税后工资（在缴纳个税之后再扣除其他扣除项）
            const afterTaxSalary = totalIncome - insuranceTotal - personalIncomeTax - inputs.otherDeductions;
            
            displayResults({
                grossSalary,
                mealAllowance,
                pensionAmount,
                medicalAmount,
                unemploymentAmount,
                housingFundAmount,
                inputs,
                personalIncomeTax,
                finalAfterTax: afterTaxSalary
            });
        }

        // 获取输入值
        function getInputs() {
            const monthlySalaryEl = document.getElementById('monthlySalary');
            const monthlySalary = parseFloat(monthlySalaryEl.value) || 0;
            const specialDeductionValue = parseFloat(document.getElementById('specialDeduction').value);
            return {
                monthlySalary,
                workDays: parseFloat(document.getElementById('workDays').value) || null,
                insuranceBase: parseFloat(document.getElementById('insuranceBase').value) || monthlySalary,
                housingFundRate: (parseFloat(document.getElementById('housingFundRate').value) || 0) / 100,
                specialDeduction: isNaN(specialDeductionValue) ? 1500 : specialDeductionValue,
                otherDeductions: parseFloat(document.getElementById('otherDeductions').value) || 0,
                mealAllowance: parseFloat(document.getElementById('mealAllowance').value) || 0
            };
        }

        // 计算应发工资
        function calculateGrossSalary(monthlySalary, workDays) {
            return monthlySalary * (workDays ? workDays / 21.75 : 1);
        }

        // 根据税率表计算个人所得税
        function calculateTax(income) {
            if (income <= 0) return 0;
            
            for (const [limit, rate, deduction] of TAX_BRACKETS) {
                if (income <= limit) {
                    return income * rate - deduction;
                }
            }
        }

        // 显示计算结果
        function displayResults(data) {
            const resultDetails = document.getElementById('resultDetails');
            const items = getResultItems(data);
            resultDetails.innerHTML = items.map(createResultRow).join('');
        }

        // 获取结果项目列表
        function getResultItems(data) {
            return [
                [`应发工资`, null, data.grossSalary],
                [`餐补`, null, data.mealAllowance],
                [`养老保险`, INSURANCE_RATES.pension, data.pensionAmount],
                [`医疗保险`, INSURANCE_RATES.medical, data.medicalAmount],
                [`失业保险`, INSURANCE_RATES.unemployment, data.unemploymentAmount],
                [`住房公积金`, data.inputs.housingFundRate, data.housingFundAmount],
                [`个人所得税`, null, data.personalIncomeTax],
                [`其他扣除`, null, data.inputs.otherDeductions],
                [`<strong>税后工资</strong>`, null, data.finalAfterTax]
            ];
        }

        // 创建结果行
        function createResultRow([name, rate, amount]) {
            return `<tr>
                <td>${name}</td>
                <td>${rate !== null ? (rate * 100).toFixed(1) + `%` : `-`}</td>
                <td>¥ ${amount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
            </tr>`;
        }

        // 页面加载时自动计算一次
        window.onload = function() {
            calculateAfterTaxSalary();
        };
    </script>
</body>
</html>
